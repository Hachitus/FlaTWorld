"use strict";!function(){window.flatworld_libraries={},window.flatworld_libraries.PIXI=window.PIXI,window.flatworld_libraries.Q=window.Q,window.flatworld_libraries.Hammer=window.Hammer,window.flatworld_libraries.Hamster=window.Hamster,window.flatworld_libraries.Handlebars=window.Handlebars,window.flatworld_libraries.log=window.log,window.flatworld_libraries.Howler=window.Howl,window.flatworld={},window.flatworld.generalUtils={},window.flatworld.log={},window.flatworld.objects={},window.flatworld.extensions={},window.flatworld.mapLayers={},window.flatworld.utils={},window.flatworld.factories={},window.flatworld.UIs={},window.flatworld.UIs["default"]={}}();
"use strict";!function(){var r=window.flatworld_libraries.log;r.enableAll(),window.flatworld.log={debug:function(o,l){r.debug(l,o)},error:function(o,l){r.error(l,o)}}}();
"use strict";!function(){function r(){function r(){Array.prototype.find||(Array.prototype.find=function(r){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof r)throw new TypeError("predicate must be a function");for(var t,n=Object(this),o=n.length>>>0,e=arguments[1],i=0;o>i;i++)if(t=n[i],r.call(e,t,i,n))return t})}function t(){"function"!=typeof Object.assign&&!function(){Object.assign=function(r){if(void 0===r||null===r)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(r),n=1;n<arguments.length;n++){var o=arguments[n];if(void 0!==o&&null!==o)for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t}}()}function n(){String.prototype.repeat||!function(){var r=function(){try{var r={},t=Object.defineProperty,n=t(r,r,r)&&t}catch(o){}return n}(),t=function(r){if(null==this)throw TypeError();var t=String(this),n=r?Number(r):0;if(n!=n&&(n=0),0>n||n==1/0)throw RangeError();for(var o="";n;)n%2==1&&(o+=t),n>1&&(t+=t),n>>=1;return o};r?r(String.prototype,"repeat",{value:t,configurable:!0,writable:!0}):String.prototype.repeat=t}()}return{arrayFind:r,objectAssign:t,es6String:n}}window.flatworld.generalUtils.polyfills=r()}();
"use strict";!function(){function n(){function n(n){return[].concat.apply([],n)}function r(n,r){for(var t=[],e=0;e<n.length;e+=r)t.push(n.slice(e,r+e));return t}return{flatten2Levels:n,chunkArray:r}}window.flatworld.generalUtils.arrays=n()}();
"use strict";!function(){function n(){function n(){var n=screen.width<=640||window.matchMedia&&window.matchMedia("only screen and (max-width: 640px)").matches,t="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;return t&&n}return{isMobile:n,isTouchDevice:t}}function t(){return"ontouchstart"in document.documentElement}window.flatworld.generalUtils.environmentDetection=n()}();
"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}();!function(){var e=window.flatworld_libraries,r=e.Q,n=e.PIXI,a=function(){function e(r){var a=arguments.length<=1||void 0===arguments[1]?{concurrency:15,crossOrigin:!1}:arguments[1];_classCallCheck(this,e);var o=a.concurrency;this.preloaderClass=new n.loaders.Loader(r,o)}return _createClass(e,[{key:"resolveOnComplete",value:function(){var e=r.defer();return this.preloaderClass.load(),this.preloaderClass.once("complete",function(r,n){e.resolve(r,n)}),e.promise}},{key:"addResource",value:function(e){this.preloaderClass.add(e)}},{key:"loadManifest",value:function(){return this}},{key:"setErrorHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"setProgressHandler",value:function(e){return this.preloaderClass.on("error",e),this}},{key:"activateSound",value:function(){this.preloaderClass.installPlugin()}}]),e}();window.flatworld.Preload=a}();
"use strict";!function(){function t(){function t(t){return Object.keys(t).map(function(n){return t[n]})}function n(t){var n=[];return n.concat.apply(n,t)}return{mapObjectsToArray:t,flattenArrayBy1Level:n}}window.flatworld.utils.dataManipulation=t()}();
"use strict";!function(){function o(){function o(){arguments.length<=0||void 0===arguments[0]?{color:"#000000",distance:5,alpha:.5,"amgÃ¶e":45,blur:5}:arguments[0]}return{dropShadow:o}}window.flatworld_libraries.PIXI;window.flatworld.utils.effects=o()}();
"use strict";!function(){function e(){function e(e){return 3===e.which}function t(e){e.addEventListener("contextmenu",function(e){e.preventDefault()})}function n(e){return{x:e.offsetX,y:e.offsetY}}function o(e){return e.center}function l(e,t){var n=i(t);return{x:e.x-n.x,y:e.y-n.y}}function i(e){for(var t=0,n=0;e;){if("body"===e.tagName.toLowerCase()){var o=e.scrollLeft||document.documentElement.scrollLeft,l=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetLeft-o+e.clientLeft,n+=e.offsetTop-l+e.clientTop}else t+=e.offsetLeft-e.scrollLeft+e.clientLeft,n+=e.offsetTop-e.scrollTop+e.clientTop;e=e.offsetParent}return{x:t,y:n}}function c(e){var t={x:0,y:0};return e||(e=window.event),e.pageX||e.pageY?(t.x=e.pageX,t.y=e.pageY):(e.clientX||e.clientY)&&(t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),t}return{isRightClick:e,disableContextMenu:t,eventData:{getPointerCoords:n,getHAMMERPointerCoords:o},coordinatesFromGlobalToRelative:l,eventMouseCoords:c}}function t(){function e(){function e(e){var t=e.cancelFullScreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.exitFullscreen;if(t)t.call(e);else if("undefined"!=typeof window.ActiveXObject){var n=new ActiveXObject("WScript.Shell");null!==n&&n.SendKeys("{F11}")}}function t(e){var t=e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen;if(t)t.call(e);else if("undefined"!=typeof window.ActiveXObject){var n=new ActiveXObject("WScript.Shell");null!==n&&n.SendKeys("{F11}")}return!1}var n=document.body,o=document.fullScreenElement&&null!==document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen;return o?e(document):t(n),!1}function t(e){return function(){var t=n();e.canvas.width=t.x,e.canvas.height=t.y}}function n(){return{x:window.innerWidth,y:window.innerHeight}}return{toggleFullScreen:e,setToFullSize:t,getWindowSize:n}}function n(){function e(e){var t=window.devicePixelRatio||1,n=e&&e.getContext("2d")||document.createElement("canvas").getContext("2d"),o=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;return t/o}return{getPixelRatio:e}}function o(){function e(e,t){return Math.abs(e)-Math.abs(t)<n}function t(e){e.style.position="absolute",e.style.display="block",e.style.left="0px",e.style.top="0px"}var n=.01;return{pixelEpsilonEquality:e,fullsizeCanvasCSS:t}}window.flatworld.utils.mouse=e(),window.flatworld.utils.resize=t(),window.flatworld.utils.environmentDetection=n(),window.flatworld.utils.general=o()}();
"use strict";!function(){function e(){var e=new PIXI.Graphics;return e.lineStyle(2,255,1),e.drawRect(50,250,100,100),e}window.flatworld.utils.shapes={createSquare:e}}();
"use strict";!function(){function n(){function n(n,t){return d("get",n,t)}function e(n,t){return d("post",n,t)}function o(n,e,o){f[n]&&t.debug("API endpoint already exists and has been defined "+n+", "+o+", "+JSON.stringify(e)),f[n]={baseUrl:o,cbs:e?[e]:[]}}function r(n){f[n]||t.debug("API endpoint not found for removing!"),delete f[n]}function u(n,e,o){f[n]&&f[n].cbs||t.debug("API endpoint not found for updating!"),f[n].cbs.push(e)}function d(n,e,o){if(!f[e])return void t.error("API endpoint for fetch not found: "+n+"/"+e+", "+(o?o[0]:"no params"));var r=f[e];return f[e].cbs.forEach(function(t){r=t(n,r,o)}),fetch(r.url,{method:n,body:r.body}).then(function(n){return n.json()}).then(function(n){t.debug("parsed json",n)})["catch"](function(n){t.debug("mapAPI http request failed",n)})}function i(){return f}var f={};return{get:n,post:e,add:o,remove:r,update:u,getAllAPIs:i}}var t=window.flatworld.log;window.flatworld.mapAPI=n()}();
"use strict";!function(){function t(){function t(t,n){document.addEventListener(t,n),i[t]=0}function e(t){var e;if(e=(new Date).getTime(),i[t]+r<e){var a=void 0;a=n(t);for(var c=arguments.length,u=Array(c>1?c-1:0),o=1;c>o;o++)u[o-1]=arguments[o];a.customData=u,document.dispatchEvent(a),i[t]=e}}var r=50,i={};return{subscribe:t,publish:e}}function n(t){var n;try{n=new Event(t)}catch(e){n=document.createEvent("Event"),n.initEvent(t,!0,!0)}return n}window.flatworld.mapEvents=t()}();
"use strict";!function(){function t(){function t(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!o[t]&&!o[t].size)throw new Error("eventlisteners.on needs to have detector set with this event type!");o[t].on(u("Map"+t,e)),n[t]=n[t]||new Set,n[t].add(e)}function r(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];o[t].off(e),e?n[t]["delete"](e):delete n[t]}function f(){var t,e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],o=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];return t=o?n[e].has(o):!!n[e].size}function v(t,n){e[t]=n}function d(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e[t]}function c(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2];o[t]={},o[t]={on:e,off:n}}function l(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];n[t].forEach(function(e){o[t].cbOff(e)}),delete n[t],delete o[t]}function u(t,e){return function(){i.publish(t),e.apply(void 0,arguments)}}return{on:t,off:r,isOn:f,setActivityState:v,getActivityState:d,setDetector:c,clearDetector:l}}var e={},n={},o={},i=window.flatworld.mapEvents;window.flatworld.eventListeners=t()}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _get=function t(e,i,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,i);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,i,r){return i&&t(e.prototype,i),r&&t(e,r),e}}();!function(){function t(t,e){var i,r=e.subcontainersConfig,n=e.subcontainerList,a=Math.floor(t.x/r.width),s=Math.floor(t.y/r.height);return n[a]=n[a]||[],i=n[a][s]=n[a][s]||[],n[a][s].length<=0&&(i=new o({x:a*r.width,y:s*r.height,width:r.width,height:r.height}),n[a][s]=i,i.x=a*r.width,i.y=s*r.height,i.visible=!r.isHiddenByDefault),t.x-=i.x,t.y-=i.y,n[a][s].addChild(t),n[a][s]}function e(t,e){for(var i=t.getSubcontainerConfigs(),r=i.width,n=i.height,a=i.maxDetectionOffset,o={x:e.x>=0?e.x-a:-a,y:e.y>=0?e.y-a:-a,width:(e.width||0)+2*a,height:(e.height||0)+2*a},s=[],c=Math.floor(o.x/r),l=Math.floor(o.y/n),u=o.width?o.x+o.width:+o.x,h=o.height?o.y+o.height:+o.y,f=Math.floor(u/r),d=Math.floor(h/n),y=t.subcontainerList,v=c;f>=v;v++)if(v>=0&&y&&y[v])for(var b=l;d>=b;b++)b>=0&&y[v][b]&&s.push(y[v][b]);return s}var i=window.flatworld_libraries.PIXI,r=[],n=function(t){function e(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],i=t.name,r=void 0===i?"":i,n=t.coord,a=void 0===n?{x:0,y:0}:n,o=t.specialLayer,s=void 0===o?!1:o,c=t.staticLayer,l=void 0===c?!0:c,u=t.selectable,h=void 0===u?!1:u;_classCallCheck(this,e);var f=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return Object.assign(f,a),f.name=""+r,f.specialLayer=!!s,f.staticLayer=!!l,f.selectable=h,f.UIObjectList={},f}return _inherits(e,t),_createClass(e,[{key:"hasSubcontainers",value:function(){return!!this.subcontainersConfig}},{key:"isCached",value:function(){return this.cacheAsBitmap}},{key:"move",value:function(t){this.x+=t.x,this.y+=t.y,this.drawThisChild=!0}},{key:"setZoom",value:function(t){return this.scale.x=this.scale.y=+t.toFixed(2),this.scale.x}},{key:"getZoom",value:function(){return this.scale.x}},{key:"getUIObjects",value:function(){return r}},{key:"getPrimaryLayers",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.filters;return this.children.filter(function(t){return!(e&&!e.filter(t).length||t.specialLayer)})}},{key:"getObjects",value:function(){var t=[];return this.hasSubcontainers()&&this.subcontainerList.forEach(function(e){t.concat(e.children)}),t}},{key:"setCache",value:function(t){var e=!!t;return this.cacheAsBitmap=e,e}},{key:"createUILayer",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"default UI layer":arguments[0],i=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],r=new e(t,i);return r.specialLayer=!0,this.addChild(r),this.UILayer=r,r}},{key:"getUILayer",value:function(){return this.UILayer}},{key:"addUIObject",value:function(t,e){var i;return r=r||[],e&&this.UIObjectList[e]&&this.deleteUIObjects(e),this.UIObjectList[e]=t,i=this.getUILayer()?this.getUILayer:this.createUILayer(),this.UILayer.addChild(t),r.push(t),r}},{key:"deleteUIObjects",value:function(t){var e=this,i=this.getUILayer();if(t){var n=this.UIObjectList[t];return i.removeChild(n),void(n=null)}return Object.keys(this.UIObjectList).map(function(t){var r=e.UIObjectList[t];i.removeChild(r),r=null}),r}}]),e}(i.Container),a=function(i){function r(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=(t.name,t.coord,t.subcontainers),i=void 0===e?!1:e,n=t.specialLayer,a=void 0===n?!1:n,o=(t.staticLayer,t.selectable),s=void 0===o?!1:o;_classCallCheck(this,r);var c=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,arguments[0]));return c.oldAddChild=_get(Object.getPrototypeOf(r.prototype),"addChild",c).bind(c),c.subcontainersConfig=i,c.subcontainerList=[],c.selectable=s,c.specialLayer=a,c}return _inherits(r,i),_createClass(r,[{key:"addChild",value:function(e){if(this.hasSubcontainers()){var i=void 0;i=t(e,this),this.oldAddChild(i)}else this.oldAddChild(e);return e}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getSubcontainersByCoordinates",value:function(t){if(!this.hasSubcontainers())throw new Error("tried to retrieve subcontainers, when they are not present");var i;return i=e(this,t)}},{key:"getSubcontainers",value:function(){return this.subcontainerList}}]),r}(n),o=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return i.specialLayer=!0,i.size=t,i.selectable=!1,i}return _inherits(e,t),_createClass(e,[{key:"getSubcontainerArea",value:function(){var t,e=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return t=e.toGlobal?this.toGlobal(new i.Point(0,0)):this,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.size.width),height:Math.round(this.size.height)}}},{key:"setCache",value:function(t){var e=!!t;return this.cacheAsBitmap=e,e}}]),e}(i.Container),s=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));return i.specialLayer=!0,i.targetSize=t,i.selectable=!1,i}return _inherits(e,t),_createClass(e,[{key:"setCache",value:function(t){var e=!!t;return this.cacheAsBitmap=e,e}}]),e}(i.Container);window.flatworld.mapLayers=window.flatworld.mapLayers||{},window.flatworld.mapLayers.MapLayer=n,window.flatworld.mapLayers.MapLayerParent=a,window.flatworld.mapLayers.MinimapLayer=s}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(){var e=window.flatworld.mapLayers,t=window.flatworld.objects,r=function(){function r(n){_classCallCheck(this,r),this.rules=Array.isArray(n)?n:[n],this.classes={layer:Object.keys(e).map(function(t){return e[t]}),object:Object.keys(t).map(function(e){return t[e]})}}return _createClass(r,[{key:"filter",value:function(e){var t,r=this;return t=Array.isArray(e)?e.filter(function(e){return r._runRule(e)}):this._runRule(e)?[e]:[]}},{key:"addRule",value:function(e){this.rules.concat(e)}},{key:"_runRule",value:function(e){var t,r=this,n=!0;return Object.keys(this.classes).forEach(function(n){var a=r.classes[n].filter(function(t){return e instanceof t});t=a.length?n:t}),this.rules.forEach(function(a){if("filter"===a.type){if(a.object!==t)return;"layer"===t?n=r._getObject(e,a):"object"===t&&(n=r._getObject(e,a))}}),n}},{key:"_getObject",value:function(e,t){return e[t.property]===t.value}}]),r}();window.flatworld.MapDataManipulator=r}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,n){var r;if(t)return t;if(!e||!n)throw new Error("UI-module requires UITheme and map object, This is an singletong class, so it's possible it should have been already called earlier");return r=n,t={},t.showSelections=function(t,o){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=n.filters,i=n.UIThemeOptions;return r&&(t=r.filterObjects(t)),t=Array.isArray(t)?t:[t],1===t.length?e.highlightSelectedObject(t[0],o,i):t.length>1?e.showSelections(t,o,i):e.showSelections([])},t.showUnitMovement=function(t,n){var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=r.filters,l=r.UIThemeOptions;return i&&(t=i.filterObjects(t)),(Array.isArray(t)||"object"!==("undefined"==typeof t?"undefined":_typeof(t))||null===t)&&o.error("Object was an Array, should be plain object: "+t.length),e.showUnitMovement(t,n,l)},t.extend=function(o){t[o]=function(){e[o]()}},t}var t,o=window.flatworld.log;window.flatworld.UI=e}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();!function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"retrieve",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{type:!1,subcontainers:[],size:{width:0,height:0}}:arguments[1],n=t.subcontainers,r=t.size,a=t.type,i=e.globalCoords,c=[];return n.length>0&&(n.forEach(function(e){c=c.concat(e.children)}),r.width&&r.height||(c=c.filter(function(e){if(a&&a!==e.type)return!1;var t=e.hitTest?e.hitTest(i):!0;return t}))),c}}]),e}();window.flatworld.ObjectManager=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}();!function(){var t=window.flatworld.utils,e=window.flatworld_libraries.PIXI,n=window.flatworld.mapAPI,o=window.flatworld.mapEvents,i=function(t){function n(t){var e=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,r=void 0===i?null:i;_classCallCheck(this,n);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,t)),l={x:Math.round(e.x),y:Math.round(e.y)};return a.position.set(l.x,l.y),a.name="Objects_sprite_"+a.id,a.type="None",a.highlightable=!0,a.data=r,a.areaWidth=a.width,a.areaHeight=a.height,a["static"]=!0,a.minimapColor=16711680,a}return _inherits(n,t),_createClass(n,[{key:"innerDraw",value:function(t,e){return this.fromFrame(this.currentFrame),this.x=t,this.y=e,this}},{key:"drawNewFrame",value:function(t,e,n){return this.currentFrame=n,this.innerDraw(t,e)}},{key:"getGraphicalArea",value:function(){var t,n=arguments.length<=0||void 0===arguments[0]?{toGlobal:!0}:arguments[0];return t=n.toGlobal?this.toGlobal(new e.Point(0,0)):this,{x:Math.round(t.x),y:Math.round(t.y),width:Math.round(this.width),height:Math.round(this.height)}}},{key:"localToLocal",value:function(t,e,n){var o=this.toGlobal({x:t,y:e}),i=n.toLocal(o);return i}},{key:"clone",value:function(t){var n=arguments.length<=1||void 0===arguments[1]?{position:!1,anchor:!1}:arguments[1],o=new e.Sprite;return o.texture=t.generateTexture(this),n.anchor&&(o.anchor=Object.assign({},this.anchor)),n.position&&(o.position=Object.assign({},this.position)),o}}]),n}(e.Sprite),r=function(t){function e(t,n){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],i=o.data,r=void 0===i?null:i;_classCallCheck(this,e);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,n,{data:r}));return a.name="DefaultTerrainObject",a.type="terrain",a.highlightable=!1,a}return _inherits(e,t),e}(i),a=function(e){function i(t,e){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=n.data,r=void 0===o?null:o;_classCallCheck(this,i);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this,t,e,{data:r}));return a.name="DefaultUnitObjects",a.type="unit",a.actions={},a}return _inherits(i,e),_createClass(i,[{key:"doAction",value:function(t){this.actions[t].forEach(function(t){t()})}},{key:"addActionType",value:function(t){this.actions[t]=this.actions[t]||[]}},{key:"addCallbackToAction",value:function(t,e){this.actions[t].push(e)}},{key:"dropShadow",value:function(){var e;return(e=t.effects).dropShadow.apply(e,arguments)}},{key:"move",value:function(t){o.publish("objectMove",this),n.post("objectMove",{id:this.id,from:{x:this.x,y:this.y},to:t})}}]),i}(i);window.flatworld.objects.ObjectSprite=i,window.flatworld.objects.ObjectSpriteTerrain=r,window.flatworld.objects.ObjectSpriteUnit=a}();
"use strict";function _classCallCheck(e,l){if(!(e instanceof l))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,l){for(var n=0;n<l.length;n++){var o=l[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(l,n,o){return n&&e(l.prototype,n),o&&e(l,o),l}}();!function(){var e=window.flatworld_libraries.Q,l=window.flatworld_libraries.Howler,n=(window.flatworld.mapLayers,function(){function n(){_classCallCheck(this,n),this._allSounds={}}return _createClass(n,[{key:"add",value:function(e,n){var o=arguments.length<=2||void 0===arguments[2]?{loop:!1,volume:1}:arguments[2],a=o.loop,t=o.volume;return this._allSounds[e]={},this._allSounds[e]=new l({urls:[n],autoplay:!1,loop:a,volume:t}),this._allSounds[e]}},{key:"remove",value:function(e){delete this._allSounds[e]}},{key:"play",value:function(l){var n=e.defer();this._allSounds[l]._onend=function(){n.resolve(!0)},this._allSounds[l].play()}},{key:"stop",value:function(e){this._allSounds[e].stop()}},{key:"fade",value:function(l,n,o,a){var t,r=e.defer();return t=function(){r.resolve(!0)},this._allSounds[l].fade(n,o,a,t),r.promise}}]),n}());window.flatworld.Sound=n}();
"use strict";!function(){function e(){return t.create({initial:"statusQuo",events:[{name:"objectSelectDialog",from:["statusQuo","objectSelected"],to:"objectSelectDialogOpened"},{name:"objectSelect",from:["statusQuo","objectSelected","objectSelectDialogOpened"],to:"objectSelected"},{name:"normalize",from:["objectSelected","objectSelectDialogOpened"],to:"statusQuo"},{name:"objectOrder",from:"objectSelected",to:"animatingObject"},{name:"objectOrderEnd",from:"animatingObject",to:"objectSelected"},{name:"UIOpen",from:["statusQuo","objectSelected","objectSelectDialogOpened"],to:"mainUIOpened"},{name:"UIClose",from:"mainUIOpened",to:"statusQuo"}]})}var t=window.StateMachine;window.flatworld.mapStates=e()}();
"use strict";!function(){function e(){function e(e){var o=d(),t=u();h=e,p=new i.Manager(e.canvas),m=new s(e.canvas),n.setDetector("fullSize",f().on,f().off),n.setDetector("fullscreen",l().on,l().off),n.setDetector("zoom",c().on,c().off),n.setDetector("drag",a().on,a().off),n.setDetector("select",t.on,t.off),n.setDetector("order",o.on,o.off),n.on("fullSize",g),e.setPrototype("setFullScreen",function(){n.on("fullscreen",v)})}function f(){var e;return{on:function(n){e=n,window.addEventListener("resize",e)},off:function(){window.removeEventListener("resize",e)}}}function l(){var e;return{on:function(n){e=n,window.addEventListener("fullscreen",e)},off:function(){window.removeEventListener("fullscreen",e)}}}function c(){var e;return{on:function(n){var o=new i.Pinch;e=n,p.add(o),p.on("pinch",e),m.wheel(e)},off:function(){p.on("pinch",e),m.unwheel(e)}}}function a(){var e;return{on:function(n){var o=new i.Pan({pointers:1,threshold:5,direction:i.DIRECTION_ALL});e=n,p.add(o),p.on("pan",e)},off:function(){p.off("pan",e)}}}function u(){var e;return{on:function(n){var o=new i.Tap;e=n,p.add(o),p.on("tap",e)},off:function(){p.off("tap",e)}}}function d(){function e(e){return r.mouse.isRightClick(e)||"press"===e.type?o.can("objectOrder")||!h.isSupportedTouch&&!r.mouse.isRightClick(e)?void n(e):!1:void 0}var n;return{on:function(o){n=o;var t=new i.Press;p.add(t),p.on("press",e),h.canvas.addEventListener("mouseup",function(n){3===n.which&&e(n)},!0)},off:function(){p.off("press",e),h.canvas.removeEventListener("mouseup",e,!0)}}}function w(){var e=document.getElementsByTagName("body")[0].style;e.webkitTouchCallout="none",e.webkitUserSelect="none",e.khtmlUserSelect="none",e.mozUserSelect="none",e.msUserSelect="none",e.userSelect="none"}function v(){r.resize.toggleFullScreen(),t.publish("mapResized"),g()}function g(){var e=r.resize.getWindowSize(),n=h.getRenderer();n.autoResize=!0,n.resize(e.x,e.y),t.publish("mapResized"),h.drawOnNextTick()}var p,m,h;return{init:e,toggleFullSize:f,toggleFullscreen:l,toggleZoom:c,toggleDrag:a,toggleSelect:u,toggleOrder:d,toggleMouseTextSelection:w,pluginName:"baseEventlisteners"}}var n=window.flatworld.eventListeners,o=window.flatworld.mapStates,t=window.flatworld.mapEvents,r=window.flatworld.utils,i=window.flatworld_libraries.Hammer,s=window.flatworld_libraries.Hamster;window.flatworld.extensions.baseEventlisteners=e()}();
"use strict";!function(){function t(){function t(t){a=r(t),n.on("drag",a)}function r(t){var r=!1;return function(i){var a;return n.getActivityState("zoom")?!1:(a=e.mouse.eventData.getHAMMERPointerCoords(i),s=!0,a.x=Math.round(a.x),a.y=Math.round(a.y),r?(i.isFinal===!0&&(r=!1,s=!1),void o(i,t,a)):(f.setOffset({x:a.x,y:a.y}),void(r=!0)))}}function o(t,n,e){var r,o;r=f.getOffset(),o={x:e.x-r.x,y:e.y-r.y},(o.x>0||o.y>0||o.x<0||o.y<0)&&n.moveMap(o),t.isFinal&&(s=!1),f.setOffset({x:e.x,y:e.y}),t.preventDefault()}function i(){function t(t){return e=t}function n(){return e}var e;return{setOffset:t,getOffset:n}}var a,f=i(),s=!1;return{init:t,pluginName:"mapDrag",_startDragListener:r}}var n=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.mapStates,window.flatworld.log;window.flatworld.extensions.mapDrag=t()}();
"use strict";!function(){function t(){function t(t){v=t,v.setPrototype("zoomIn",i),v.setPrototype("zoomOut",a),v.setPrototype("setZoomLimits",r),v.setPrototype("setZoomModifier",n),o.on("zoom",s)}function n(t){if(!(t>0||.5>=t))throw new Error("Wrong zoom modifier! (needs to be >0 and <=0.5, given:"+t);return d=t,this}function r(t,o){return w.farther=t,w.closer=o,this}function i(t){var o=this.getZoom(),e=!0;return p(this,o,Math.abs(t)||d,e)}function a(t){var o=this.getZoom(),e=!1;return t=0>t?t:-t,p(this,o,t||-d,e)}function s(t,o,e,r){o?u(t,o,e,r):t.pointers&&(g||(g=!0,n(.5*d)),m(t))}function u(t,o,e,n){var r=n,i=v.getZoom();t.preventDefault(),r>0?v.zoomIn()&&v.moveMap(c(i,!0)):0>r&&v.zoomOut()&&v.moveMap(c(i))}function m(t){var e=t.pointers,n=[{x:e[0].pageX,y:e[0].pageY},{x:e[1].pageX,y:e[1].pageY}],r=Math.abs(n[0].x-n[1].x),i=Math.abs(n[0].y-n[1].y);t.preventDefault();try{if(!l)return h={x:r,y:i},o.setActivityState("zoom",!0),void(l=!0);4!==t.eventType&&8!==t.eventType||(window.setTimeout(function(){o.setActivityState("zoom",!1)},y),l=!1),h.x+h.y<r+i?v.zoomIn()&&v.moveMap(c(v.getZoom(),!0)):v.zoomOut()&&v.moveMap(c(v.getZoom())),h={x:r,y:i}}catch(a){console.log("Error! ",a)}}function f(t,o){return!!(o&&t>w.closer||!o&&t<w.farther)}function c(t,o){var n=e.resize.getWindowSize(),r={x:n.x/2/t,y:n.y/2/t},i={x:r.x*(o?-d:d),y:r.y*(o?-d:d)};return i}function p(t,o,e,n){var r;return f(o,n)||(r=t.setZoom(e?o+e:o+d)),r}var v,y=40,l=!1,g=!1,h={},w={farther:.4,closer:2.5},d=.1;return{init:t,pluginName:"mapZoom"}}var o=window.flatworld.eventListeners,e=window.flatworld.utils;window.flatworld.extensions.mapZoom=t()}();
"use strict";window.flatworld.extensions.hexagons={},window.flatworld.extensions.hexagons.utils={},window.flatworld.extensions.hexagons.eventlisteners={};
"use strict";!function(){function o(o){var n=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=t.orientation,i=void 0===r?"horizontal":r;h=o,x=n,f=i}function n(){var o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=o.radius,t=void 0===n?h:n,r=o.orientation,i=void 0===r?"horizontal":r;t||u.error("You need to define at least globalRadius for the hexagonMath utils class");var a="horizontal"===i?.5:0,e={x:t,y:t},l=2*Math.PI/6*a,s=e.x*Math.cos(l),d=e.y*Math.sin(l),x=[];x.push({x:s,y:d});for(var f=1;7>f;f++)l=2*Math.PI/6*(f+a),s=e.x*Math.cos(l),d=e.y*Math.sin(l),x.push({x:s,y:d});return x}function t(){var o,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=n.radius,r=void 0===t?h:t,i=n.floorNumbers,a=void 0===i?!0:i;return o=r*Math.sqrt(3),o=a?Math.floor(o):o}function r(){var o,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=n.radius,r=void 0===t?h:t,i=n.floorNumbers,a=void 0===i?!0:i;return o=2*r,o=a?Math.floor(o):o}function i(){var o=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=o.radius,t=void 0===n?h:n;return r(t)-t/2}function a(o,n){var t,r=arguments.length<=2||void 0===arguments[2]?{x:0,y:0}:arguments[2];return t=o.map(function(o){return{x:o.x+r.x,y:o.y+r.y}}),d(n,t)}function e(o){var n,i,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=a.radius,l=void 0===e?h:e,s=a.orientation,d=void 0===s?"horizontal":s,u=o.rows,x=o.columns,f=[],v=t(l),g=r(l)-l/2;n="horizontal"===d?g:v,i="horizontal"===d?v:g;for(var w=0;u>w;w++)for(var c=0;x>c;c++)f.push({x:Math.round(c*i+("horizontal"!==d||0!==w&&w%2!==0?-v/2:0)),y:w*n});return f}function l(o){var n,a=h;if(!f||!a||!x)throw new Error("getClosestHexagonCenter requirements not filled");return n="horizontal"===f?{x:Math.round(o.x-o.x%t(a)+t(a)/2+x.x),y:Math.round(o.y-o.y%i(a)+r(a)/2+x.y)}:{x:Math.floor(o.x-o.x%i(a)+x.x),y:Math.floor(o.y-o.y%t(a)+x.y)}}function s(o){return{x:o.x/t(),y:o.y/r()}}function d(o,n){for(var t,r,i,a,e,l=o.x,s=o.y,d=!1,u=0,h=n.length-1;u<n.length;h=u++)t=n[u].x,i=n[u].y,r=n[h].x,a=n[h].y,e=i>s!=a>s&&(r-t)*(s-i)/(a-i)+t>l,e&&(d=!d);return d}var u=window.flatworld.log;window.flatworld.extensions.hexagons.utils.init=o,window.flatworld.extensions.hexagons.utils.createHexagonGridCoordinates=e,window.flatworld.extensions.hexagons.utils.getHexagonPoints=n,window.flatworld.extensions.hexagons.utils.calcShortDiagonal=t,window.flatworld.extensions.hexagons.utils.calcLongDiagonal=r,window.flatworld.extensions.hexagons.utils.hexaHitTest=a,window.flatworld.extensions.hexagons.utils.getClosestHexagonCenter=l,window.flatworld.extensions.hexagons.utils.calculateIndex=s;var h,x,f}();
"use strict";!function(){function n(n){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=o.orientation,r=void 0===e?"horizontal":e,a=[];if("horizontal"!==r)throw new Error("Nothing else than horizontal supported so far!");return a=i(n),new t.Polygon(a)}function o(n){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],e=o.color,r=void 0===e?16711680:e,a=o.isFlatTop,l=void 0===a?!1:a,s=new t.Graphics,w=i(n,l);return s.beginFill(r,1),s.drawPolygon(w,l),s.endFill(),s}function i(n){return e({radius:n}).map(function(n){return new t.Point(n.x,n.y)})}var t=window.flatworld_libraries.PIXI,e=window.flatworld.extensions.hexagons.utils.getHexagonPoints;window.flatworld.extensions.hexagons.utils.createHexagon=n,window.flatworld.extensions.hexagons.utils.createVisibleHexagon=o}();
"use strict";!function(){function e(e){function d(r){var a,d=t.mouse.eventData.getHAMMERPointerCoords(r),s={allData:function(e){return e.data.typeData}},u=new n({type:"filter",object:"layer",property:"name",value:"unitLayer"});return l.objectSelect(),a=e.getObjectsUnderArea(d,{filters:u}),a=t.dataManipulation.mapObjectsToArray(a),a=t.dataManipulation.flattenArrayBy1Level(a),a.length?(e.currentlySelectedObjects=a,o.publish("objectsSelected",a),c.showSelections(a,s),void e.drawOnNextTick()):(e.currentlySelectedObjects=void 0,i.debug("No objects found for selection!"),void c.showSelections([]))}function s(r){var a,d;new n({type:"filter",object:"layer",property:"name",value:"unitLayer"});return e.currentlySelectedObjects?e.currentlySelectedObjects.length>1?void i.debug("the selected object is only supported to be one atm."+JSON.stringify(e.currentlySelectedObjects)):(d=e.currentlySelectedObjects[0],l.objectOrder(),a=e.isSupportedTouch?t.mouse.eventData.getHAMMERPointerCoords(r):t.mouse.eventData.getPointerCoords(r),d.move(a),o.publish("objectMoves",d),c.showUnitMovement(d,a),l.objectOrderEnd(),void e.drawOnNextTick()):void i.debug("No objects selected for orders! "+JSON.stringify(d))}var c;if(!e)throw new Error("eventlisteners initialization requires flatworld instance as a parameter");return c=r(),a.on("select",d),a.on("order",s),!0}var t=window.flatworld.utils,o=window.flatworld.mapEvents,r=window.flatworld.UI,n=window.flatworld.MapDataManipulator,a=window.flatworld.eventListeners,l=window.flatworld.mapStates,i=window.flatworld.log;window.flatworld.extensions.hexagons.setupHexagonClick=e}();
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(t){if(!t)throw new Error("Need radius!");var n=Math.round(s(t)),i=Math.round(c(t)),r=Math.round(t);this.anchor.set(.5,.5),this.areaHeight=this.HEIGHT=n,this.areaWidth=this.WIDTH=i,this.SIDE=r,this.ROW_HEIGHT=Math.round(.75*n),this.hitArea=e(t),this.hitTest=function(t){var e;return e=this.toLocal(new h.Point(t.x,t.y)),this.hitArea.contains(e.x,e.y)}}function e(t){return n||(n=l(t)),n}var n,i=window.flatworld.objects,r=i.ObjectSpriteTerrain,o=i.ObjectSpriteUnit,a=window.flatworld.extensions.hexagons.utils,s=a.calcLongDiagonal,c=a.calcShortDiagonal,l=a.createHexagon,h=window.flatworld_libraries.PIXI,u=function(e){function n(e){var i=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=r.data,a=r.radius,s=r.minimapColor,c=r.minimapShape;_classCallCheck(this,n);var l=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,i,{data:o}));return l.name="DefaultTerrainObject_hexa",l.minimapColor=s,l.minimapShape=c,t.call(l,a),l}return _inherits(n,e),n}(r),f=function(e){function n(e){var i=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=r.data,a=r.radius,s=r.minimapColor,c=r.minimapShape;_classCallCheck(this,n);var l=_possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this,e,i,{data:o}));return l.name="DefaultUnitObjects_hexa",l.minimapColor=s,l.minimapShape=c,l["static"]=!1,t.call(l,a),l}return _inherits(n,e),n}(o);window.flatworld.extensions.hexagons.objects={ObjectHexaTerrain:u,ObjectHexaUnit:f}}();
"use strict";!function(){function n(){function n(n){o=n,t(o)}function t(n){return e(n)}var o={};return{init:n,pluginName:"selectHexagonObject"}}var e=window.flatworld.extensions.hexagons.setupHexagonClick;window.flatworld.extensions.hexagons.selectHexagonObject=n()}();
"use strict";!function(){function t(){function t(t){d=t,w=d.getZoom(),i(),o(),d.drawOnNextTick(),b&&(window.FlaTWorld_mapMovement_subCheck=function(){d.getPrimaryLayers().forEach(function(t){var e,i,r=n.flatten2Levels(t.getSubcontainers());e=r.filter(function(t){return t.visible}),i=r.filter(function(t){return!t.visible});var o=e.reduce(function(t,e){t+e.x+""});window.flatworld.log.debug("visible subcontainers: "+e.length+", "+o+"\n\ninvisible: "+i.length)})},window.FlaTWorld_mapMovement_deactivate=function(){d.getPrimaryLayers().forEach(function(t){var e,i=n.flatten2Levels(t.getSubcontainers());e=i.forEach(function(t){t.visible=!1})})})}function i(){var t;t=d.getViewportArea(!0),d.getPrimaryLayers().forEach(function(e){var i=n.flatten2Levels(e.getSubcontainers());i.forEach(function(e){e.visible=!a(e,t)})})}function r(){function t(){var t;t=d.getViewportArea(!0),c(t,d.getPrimaryLayers())}if(g.processing)return!1;g.processing=!0;var e=t();window.setTimeout(e,v)}function o(){function t(t){var e=t.customData[0];m.width+=e.x,m.height+=e.y,r()}function n(){r()}function i(t){w=t.customData[0].newScale,r()}e.subscribe("mapMoved",t),e.subscribe("mapResized",n),e.subscribe("mapZoomed",i)}function a(t,e){var n,i;return i=t.getSubcontainerArea({toGlobal:!1}),n=!s(i,e)}function c(t,e){var i,r,o=[];r=u(t),m.width=0,m.height=0,e=n.chunkArray(e,2),i=e.map(function(t){var e=window.Q.defer();return window.setTimeout(function(){var n;n=t.map(function(t){return t.getSubcontainersByCoordinates(r)}),o=o.concat(n),e.resolve(!0)}),e.promise}),i=window.Q.all(i).then(function(){var e,i;return o=n.flatten2Levels(o),e=n.chunkArray(o,40),i=e.map(function(e){var n=window.Q.defer();return window.setTimeout(function(){e.forEach(function(e){e.visible=!a(e,t)}),n.resolve(!0)}),n.promise})}),window.Q.all(i).then(function(){g.processing=!1,d.drawOnNextTick()}).then(null,function(t){window.flatworld.log.debug(t)})}function u(t){var e=arguments.length<=1||void 0===arguments[1]?{scale:1}:arguments[1],n=f(t,e);return{x:Math.round(t.x-n),y:Math.round(t.y-n),width:Math.round(t.width+2*n),height:Math.round(t.height+2*n)}}function s(t,e){return t.x<=e.x+e.width&&e.x<=t.x+t.width&&t.y<=e.y+e.height&&e.y<=t.y+t.height}function f(t){var e=arguments.length<=1||void 0===arguments[1]?{scale:1}:arguments[1];return Math.abs(t.width/e.scale*h)}function l(t){d=t}var d,w,h=.2,v=20,g={},m={width:0,height:0},b=!1;return{init:t,pluginName:"mapMovement",addAll:i,check:r,startEventListeners:o,_testObject:{isObjectOutsideViewport:a,viewportWorkerOnMessage:c,getViewportWithOffset:u,testRectangleIntersect:s,_setMap:l}}}var e=window.flatworld.mapEvents,n=window.flatworld.generalUtils.arrays;window.flatworld.extensions.mapMovement=t()}();
"use strict";window.flatworld.extensions.minimaps={};
"use strict";!function(){function i(){function i(i){h=i,x=new o.Manager(h.minimapCanvas),h.initMinimap=r,y=h.getMinimapLayer()}function r(i,e,a,t,o,r){var s=arguments.length<=6||void 0===arguments[6]?{}:arguments[6],p=s.xPadding,u=void 0===p?10:p,v=s.yPadding,h=void 0===v?10:v;return C=u,z=h,y.minimapSize=e,M=o,d(i),l(a),c(t),w(y.minimapSize.x,y.minimapSize.y,y.minimapSize.width,y.minimapSize.height),m(),f(),b=r,y.addChild(b),n.publish("minimapInitialized",y),y}function d(i){y.addChild(i)}function l(i){var n=new a({type:"filter",object:"layer",property:"staticLayer",value:!0}),e=v();h.getAllObjects({filters:n}).forEach(function(n){e.addChild(i(n))}),e.cacheAsBitmap=!0,y.addChild(e)}function c(i){var n=new a({type:"filter",object:"object",property:"static",value:!1}),e=v();h.getAllObjects({filters:n}).forEach(function(n){e.addChild(i(n))}),y.addChild(e)}function m(){n.subscribe("mapMoved",s),n.subscribe("mapZoomed",p),n.subscribe("minimapClicked",u)}function s(){if(!(g-Date.now()>-5)){var i=M(h.getMovableLayer(),!0);b.x=i.x,b.y=i.y,h.drawOnNextTick()}}function p(i){b.scale.x+=.1,b.scale.y=.1}function u(i){var n=t.mouse.eventData.getHAMMERPointerCoords(i),e=new PIXI.Point(i.srcEvent.layerX,i.srcEvent.layerY);n=t.mouse.coordinatesFromGlobalToRelative(n,h.minimapCanvas),g=Date.now(),n.x-=Math.round(b.width/2),n.y-=Math.round(b.height/2),e=M(n,!0),b.x=e.x,b.y=e.y,e=M(n,!1),h.moveMap(e,{absolute:!0,noEvent:!0}),h.drawOnNextTick()}function f(){var i,n={on:function(n){var e=new o.Tap;i=n,x.add(e),x.on("tap",i)},off:function(){x.on("tap",i)}};e.setDetector("minimapClicked",n.on,n.off),e.on("minimapClicked",u)}function w(i,n,e,a){var t=h.getRenderer("minimap");y.position=new PIXI.Point(i,n),t.autoResize=!0,t.resize(e+2*C,a+2*z),h.drawOnNextTick()}function v(){var i=new PIXI.Container;return i.x=C,i.y=z,i}var h,y,b,x,M,g,C=0,z=0;return{init:i,pluginName:"pixelizedMinimap",initMinimap:r,_testObject:{}}}var n=window.flatworld.mapEvents,e=window.flatworld.eventListeners,a=window.flatworld.MapDataManipulator,t=window.flatworld.utils,o=window.flatworld_libraries.Hammer;window.flatworld.extensions.minimaps.pixelizedMinimap=i()}();
"use strict";!function(){function i(){function i(i){d=i,d.initMinimap=e,n=d.getMinimapLayer()}function e(i,e,d){var h=i.width,u=i.height,p=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],g=p.x,l=void 0===g?0:g,c=p.y,f=void 0===c?0:c;PIXI.Texture.fromFrame(e);n.targetSize.x=h,n.targetSize.y=u,a(e),r(d),o(Math.round(l),Math.round(f)),t.publish("minimapInitialized",m)}function a(i){var t=PIXI.Texture.fromFrame(i),n=new PIXI.Sprite(t);d.getMinimapLayer().addChild(n)}function r(i){i.width=n.targetSize.x/d.width,i.height=n.targetSize.y/d.height,n.addChild(i)}function o(i){var t=i.x,n=i.y;d.getMinimapLayer().position(new PIXI.Point(t,n))}var d,m;return{init:i,pluginName:"scaledMinimap",_testObject:{}}}var t=window.flatworld.mapEvents;window.flatworld.extensions.minimaps.scaledMinimap=i();var n}();
"use strict";window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]={},window.flatworld.UIs["default"].utils={},window.flatworld.UIs["default"].layout={};
"use strict";!function(){window.flatworld.UIs["default"].utils.drawShapes=function(){function t(t,e,a,n,o,i,r,s,h){function M(t,e,a,n,o,i,r,s){var h;switch(e=+e,a=+a,n=+n,o=+o,i=+i,r=+r,t.beginStroke("#F00").moveTo(e,a).lineTo(n,o).lineTo(i,r),s){case 0:h=Math.sqrt((i-e)*(i-e)+(r-a)*(r-a)),t.arcTo(n,o,e,a,.55*h),t.fill();break;case 1:t.beginStroke("#F00").moveTo(e,a).lineTo(n,o).lineTo(i,r).lineTo(e,a).fill();break;case 2:break;case 3:var M=(e+n+i)/3,f=(a+o+r)/3;t.beginFill().quadraticCurveTo(M,f,e,a);break;case 4:var c,l,d,u,p=5;if(i===e)h=r-a,c=(n+e)/2,d=(n+e)/2,l=o+h/p,u=o-h/p;else{h=Math.sqrt((i-e)*(i-e)+(r-a)*(r-a));var y=(e+i)/2,v=(a+r)/2,T=(y+n)/2,b=(v+o)/2,g=(r-a)/(i-e),k=h/(2*Math.sqrt(g*g+1))/p,I=g*k;c=T-k,l=b-I,d=T+k,u=b+I}t.bezierCurveTo(c,l,d,u,e,a),t.fill()}}var f,c,l,d,u,p,y=t.graphics,v="#000";"string"==typeof e&&(e=parseInt(e,10)),"string"==typeof a&&(a=parseInt(a,10)),"string"==typeof n&&(n=parseInt(n,10)),"string"==typeof o&&(o=parseInt(o,10)),i="undefined"!=typeof i?i:3,r="undefined"!=typeof r?r:1,s="undefined"!=typeof s?s:Math.PI/8,h="undefined"!=typeof h?h:10;var T,b,g,k,I="function"!=typeof i?M:i,S=Math.sqrt((n-e)*(n-e)+(o-a)*(o-a)),m=(S-h/3)/S;1&r?(T=Math.round(e+(n-e)*m),b=Math.round(a+(o-a)*m)):(T=n,b=o),2&r?(g=e+(n-e)*(1-m),k=a+(o-a)*(1-m)):(g=e,k=a),y.beginStroke(v).moveTo(g,k).lineTo(T,b);var q=Math.atan2(o-a,n-e),w=Math.abs(h/Math.cos(s));return 1&r&&(f=q+Math.PI+s,c=n+Math.cos(f)*w,l=o+Math.sin(f)*w,d=q+Math.PI-s,u=n+Math.cos(d)*w,p=o+Math.sin(d)*w,I(y,c,l,n,o,u,p,i)),2&r&&(f=q+s,c=e+Math.cos(f)*w,l=a+Math.sin(f)*w,d=q-s,u=e+Math.cos(d)*w,p=a+Math.sin(d)*w,I(y,c,l,e,a,u,p,i)),!0}function e(e,a,n,o,i,r,s,h,M,f,c){var l,d,u,p,y;h="undefined"!=typeof h?h:3,M="undefined"!=typeof M?M:1,f="undefined"!=typeof f?f:Math.PI/8,c="undefined"!=typeof c?c:10,e.beginPath(),e.arc(a,n,o,i,r,s),e.stroke(),e.strokeStyle="rgba(0,0,0,0)",1&M&&(l=Math.cos(i)*o+a,d=Math.sin(i)*o+n,u=Math.atan2(a-l,d-n),s?(p=l+10*Math.cos(u),y=d+10*Math.sin(u)):(p=l-10*Math.cos(u),y=d-10*Math.sin(u)),t(e,l,d,p,y,h,2,f,c)),2&M&&(l=Math.cos(r)*o+a,d=Math.sin(r)*o+n,u=Math.atan2(a-l,d-n),s?(p=l-10*Math.cos(u),y=d-10*Math.sin(u)):(p=l+10*Math.cos(u),y=d+10*Math.sin(u)),t(e,l,d,p,y,h,2,f,c))}function a(t,e,a){var n=arguments.length<=3||void 0===arguments[3]?{color:"#000000",style:5}:arguments[3],o=n.color,i=n.style;return t.lineStyle(i,o),t.moveTo(e.x,e.y),t.lineTo(a.x,a.y),t.endFill(),t}return{normal:t,arced:e,line:a}}()}();
"use strict";!function(){var l=window.flatworld_libraries.Handlebars;window.flatworld.UIs=window.flatworld.UIs||{},window.flatworld.UIs["default"]=window.flatworld.UIs["default"]||{},window.flatworld.UIs["default"].templates={multiSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        {{#each objects}}\n        <li>\n          {{this.data.typeData.name}}\n        </li>\n        {{/each}}\n      </ul>"),singleSelection:l.compile("\n      <span style='font-size:200%;display:block;margin-bottom:20px;'>\n        {{title}}\n      </span>\n      <ul>\n        <li>\n          {{object.name}}\n        </li>\n      </ul>")}}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var l=0;l<t.length;l++){var o=t[l];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,l,o){return l&&e(t.prototype,l),o&&e(t,o),t}}();!function(){function e(e){if(!s[e]){var t=document.querySelector(l[e]);s[e]=t}return s[e]}var t,l,o=window.flatworld_libraries.PIXI,n=window.flatworld.UIs["default"].templates,a=window.flatworld.extensions.hexagons.utils.createVisibleHexagon,i=window.flatworld.UIs["default"].utils.drawShapes,r=window.flatworld.log,s={},c=function(){function s(e,o){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=n.styles,i=void 0===a?"#F0F0F0":a,r=n.elements;_classCallCheck(this,s),l=r,t=this.addStyleElement();var c="\n        "+l.select+" {\n          z-index: 9999;\n          opacity: 0.9;\n          position: fixed;\n          left: 0px;\n          bottom: 0px;\n          background-color: brown;\n          border: 1px solid rgb(255, 186, 148);;\n          border-bottom: 0px;\n          padding:15px;\n          margin-left:10px;\n        }";this.addCSSRulesToScriptTag(t,c),this.FTW=o,this.modal=e||document.getElementById("dialog_select"),this.styles=i}return _createClass(s,[{key:"setFlatworld",value:function(e){this.FTW=e}},{key:"getTemplates",value:function(){return n}},{key:"showSelections",value:function(t,o,a){var i,s=this,c=this.FTW.drawOnNextTick.bind(this.FTW),d=this.FTW.getMovableLayer();i=t&&t.length>1?function(){s.modal.innerHTML=n.multiSelection({title:"Objects",objects:t}),s.showModal(s.modal,l),e("select").style.display="block"}:t&&1===t.length?function(){s.highlightSelectedObject(t[0])}:function(){d.deleteUIObjects(),c(),r.debug("Error occured selecting the objects on this coordinates! Nothing found")},e("select").style.display="none",i()}},{key:"highlightSelectedObject",value:function(t,o){var a,i,r=arguments.length<=2||void 0===arguments[2]?{shadow:{color:"0x0000",distance:5,alpha:.55,angle:45,blur:5}}:arguments[2],s=r.shadow;return i=o.allData(t),this.modal.innerHTML=n.singleSelection({title:"Selected",object:{name:i.name}}),this.showModal(this.modal,l),a=this._highlightSelectedObject(t,this.FTW.getRenderer()),a.dropShadow({color:s.color,distance:s.distance,alpha:s.alpha,angle:s.angle,blur:s.blur}),this.FTW.drawOnNextTick(),e("select").style.display="block",a}},{key:"showUnitMovement",value:function(e,t){var l,n,a,r="movementArrow";l=this.FTW.getMovableLayer().toLocal(t),n=this.FTW.getMovableLayer().toLocal(e.toGlobal(new o.Point(0,0))),a=i.line(new o.Graphics,n,l),this.FTW.removeUIObject(this.FTW.layerTypes.movableType.id,r),this.FTW.addUIObject(this.FTW.layerTypes.movableType.id,a,r),this.FTW.drawOnNextTick()}},{key:"_highlightSelectedObject",value:function(e,t){var l,n=this.FTW.getMovableLayer();l=e.clone(t),l.__proto__=e.__proto__;var a=e.toGlobal(new o.Point(0,0));return a=n.toLocal(a),a.x-=e.width*e.anchor.x,a.y-=e.height*e.anchor.y,this.createHighlight(l,{coords:a}),l}},{key:"createHighlight",value:function(e){var t,l=arguments.length<=1||void 0===arguments[1]?{coords:new o.Point(0,0)}:arguments[1],n=47,i="unit highlight",r=this.FTW.getMovableLayer(),s=new this.FTW.createSpecialLayer("UILayer",{toLayer:r}),c={x:Number(e.x),y:Number(e.y)};t=a(n,{color:"#F0F0F0"}),t.x=c.x+32,t.y=c.y+27,t.alpha=.5,s.addChild(t),s.addChild(e),s.position=l.coords,this.FTW.removeUIObject(this.FTW.layerTypes.movableType.id),this.FTW.addUIObject(this.FTW.layerTypes.movableType.id,s,i)}},{key:"addCSSRulesToScriptTag",value:function(e,t){e.insertRule(t,0)}},{key:"addStyleElement",value:function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}},{key:"showModal",value:function(e,t){e.classList.add(t.select)}}]),s}();window.flatworld.UIs["default"].init=c}();
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(){function e(e,t){t?i.children.forEach(function(t){if(!t.isCached())return!1;var i=t.getSubcontainers();i.forEach(function(t){t.setCache(e)})}):i.children.forEach(function(t){return t.isCached()?void t.setCache(e):!1})}var t,i,n,a,r,o,u=window.flatworld_libraries,l=u.Q,s=u.PIXI,c=window.flatworld,h=c.mapLayers,y=c.ObjectManager,d=c.mapEvents,v=c.generalUtils,g=c.log,f=c.utils,m=0,p=1,b=2,w="0.0.0",k=!1,L=[],S=function(){function u(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0],l=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=l.bounds,d=void 0===c?{width:0,height:0}:c,g=l.mapSize,k=void 0===g?{x:0,y:0}:g,L=l.rendererOptions,S=void 0===L?{autoResize:!0,antialias:!1}:L,C=l.minimapCanvas,M=l.subcontainers,x=void 0===M?!1:M,O=l.cache,P=void 0===O?!1:O,T=l.trackFPSCB,j=void 0===T?!1:T,A=l.defaultScaleMode,_=void 0===A?s.SCALE_MODES.DEFAULT:A;if(_classCallCheck(this,u),!e)throw new Error(this.constructor.name+" needs canvas element!");"string"==typeof e&&(e=document.querySelector(e)),e.innerHTML="",S.view=e,a=new s.WebGLRenderer(d.width,d.height,S),r=C?new s.WebGLRenderer(0,0,{view:C,autoResize:!0}):void 0,a.plugins.interaction.destroy(),o=x?h.MapLayerParent:h.MapLayer,t=new h.MapLayer({name:"staticLayer",coord:{x:0,y:0}}),i=new h.MapLayer({name:"movableLayer",coord:{x:0,y:0}}),n=new h.MapLayer({name:"minimapLayer",coord:{x:0,y:0}}),t.addChild(i),f.general.fullsizeCanvasCSS(a.view),document.getElementsByTagName("body")[0].style.overflow="hidden",f.mouse.disableContextMenu(a.view),this.defaultScaleMode=s.SCALE_MODES.DEFAULT=_,this.canvas=a.view,this.minimapCanvas=r?r.view:void 0,this.mapSize=k,this.plugins=new Set,this.subcontainersConfig=x,this.trackFPSCB=j,this.objectManager=new y,this.cache=P,this.isSupportedTouch=v.environmentDetection.isTouchDevice(),this.currentlySelectedObjects=[],this.layerTypes={staticType:{id:m,layer:t},movableType:{id:p,layer:i},minimapType:{id:b,layer:n}},this.VERSION=w}return _createClass(u,[{key:"init",value:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{x:0,y:0}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?null:arguments[2],a=arguments.length<=3||void 0===arguments[3]?{fullsize:!0}:arguments[3],r=[];return a.fullsize&&this.toggleFullsize(),e.length&&(r=this.activatePlugins(e)),t&&Object.assign(i,t),this._defaultTick(),n&&this.customTickOn(n),L=r,this.cache&&this.cacheMap(),this.drawOnNextTick(),r||Promise.resolve()}},{key:"whenReady",value:function(){return l.all(L)}},{key:"drawOnNextTick",value:function(){k=!0}},{key:"addUIObject",value:function(e,t,i){var n=this;Array.isArray(t)?t.forEach(function(t){n._addObjectToUIlayer(e,t)}):this._addObjectToUIlayer(e,t,i)}},{key:"removeUIObject",value:function(e,t){switch(e){case m:this.getStaticLayer().deleteUIObjects(t);break;case p:this.getMovableLayer().deleteUIObjects(t)}}},{key:"createSpecialLayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"default special layer":arguments[0],t=arguments.length<=1||void 0===arguments[1]?{coord:{x:0,y:0},toLayer:!1}:arguments[1],i=t.coord||{x:0,y:0},n=new h.MapLayer(e,i);return n.specialLayer=!0,t.toLayer&&t.toLayer.addChild(n),n}},{key:"addLayer",value:function(e){var t;return this.getSubcontainerConfigs()&&e.subcontainers!==!1&&(e.subcontainers=this.getSubcontainerConfigs()),t=new o(e),this.getMovableLayer().addChild(t),t}},{key:"usesSubcontainers",value:function(){return!!this.getSubcontainerConfigs()}},{key:"getSubcontainerConfigs",value:function(){return this.subcontainersConfig}},{key:"getViewportArea",value:function(){var e,t,i,n=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],a=new s.Point(0,0),r=new s.Point(window.innerWidth,window.innerHeight);if(n){e=this.getMovableLayer();var o=e.toLocal(r),u=e.toLocal(a);i={x:u.x,y:u.y},t={x2:o.x,y2:o.y}}else e=this.getStaticLayer(),i={x:a.x,y:a.y},t={x2:r.x,y2:r.y};return{x:Math.round(i.x),y:Math.round(i.y),width:Math.round(Math.abs(Math.abs(t.x2)-i.x)),height:Math.round(Math.abs(Math.abs(t.y2)-i.y))}}},{key:"removeLayer",value:function(e){return i.removeChild(e),e}},{key:"getMapsize",value:function(){return this.mapSize}},{key:"moveMap",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.absolute,a=void 0===n?!1:n,r={x:Math.round(e.x/this.getStaticLayer().getZoom()),y:Math.round(e.y/this.getStaticLayer().getZoom())};a?i.position=new s.Point(e.x,e.y):i.move(r),d.publish("mapMoved",r),this.drawOnNextTick()}},{key:"isCacheActivated",value:function(){return this.cache}},{key:"cacheMap",value:function(t){e(!0,this.usesSubcontainers())}},{key:"unCacheMap",value:function(){e(!1,this.usesSubcontainers())}},{key:"activatePlugins",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],i=[];return t.forEach(function(t){"object"===("undefined"==typeof t?"undefined":_typeof(t))?e.activatePlugin(t):g.error("problem with initializing a plugin: "+t.name)}),i}},{key:"activatePlugin",value:function(e){try{if(!e||!e.pluginName||!e.init)throw new Error("plugin, plugin.pluginName or plugin.init import is missing!");this.plugins.add(e[e.pluginName]),this.plugins.has(e[e.pluginName])&&e.init(this)}catch(t){g.error('An error initializing plugin. JSON.stringify: "'+JSON.stringify(e)+'" ',t)}}},{key:"setPrototype",value:function(e,t){var i=Object.getPrototypeOf(this);i[e]=t}},{key:"getObjectsUnderArea",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{x:0,y:0,width:0,height:0}:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.filters,n=void 0===i?null:i,a={globalCoords:e,localCoords:this.getMovableLayer().toLocal(new s.Point(e.x,e.y))},r={};if(a.localCoords.width=e.width,a.localCoords.height=e.height,this.usesSubcontainers()){var o=this._getSubcontainersUnderArea(a,{filters:n});r=this._retrieveObjects(a,{subcontainers:o})}return r}},{key:"getPrimaryLayers",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.filters;return this.getMovableLayer().getPrimaryLayers({filters:t})}},{key:"getAllObjects",value:function(){var e,t,i=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=i.filters;return e=this.getPrimaryLayers({filters:n}).map(function(e){var i;if(e.hasSubcontainers()){var a=v.arrays.flatten2Levels(e.getSubcontainers());i=a.map(function(e){return t=e.children.map(function(e){return n?n.filter(e):e}),v.arrays.flatten2Levels(t)})}else i=e.children.map(function(e){return n?n.filter(e):e});return v.arrays.flatten2Levels(i)}),e=v.arrays.flatten2Levels(e)}},{key:"getMapCoordinates",value:function(){return{x:this.getMovableLayer().x,y:this.getMovableLayer().y}}},{key:"getZoomLayer",value:function(){return this.getStaticLayer()}},{key:"setZoom",value:function(e){return this.getZoomLayer().setZoom(e),d.publish("mapZoomed",{previousScale:this.getZoom(),newScale:e}),e}},{key:"getZoom",value:function(){return this.getZoomLayer().getZoom()}},{key:"getRenderer",value:function(e){return"minimap"===e?r:a}},{key:"getStaticLayer",value:function(){return t}},{key:"getMovableLayer",value:function(){return i}},{key:"getMinimapLayer",value:function(){return n}},{key:"removeMinimapLayer",value:function(){n=void 0}},{key:"zoomIn",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"zoomOut",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullsize",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"toggleFullScreen",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"initMinimap",value:function(){return"notImplementedYet. Activate with plugin"}},{key:"_retrieveObjects",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.type,n=void 0===i?"":i,a=t.subcontainers,r=void 0===a?[]:a;return this.objectManager.retrieve(e,{type:n,subcontainers:r,size:{width:e.globalCoords.width,height:e.globalCoords.height}})}},{key:"_getLayersWithAttributes",value:function(e,t){return this.getMovableLayer().children[0].children.filter(function(i){return i[e]===t})}},{key:"_getSubcontainersUnderArea",value:function(e){var t,i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=i.filters,a=this.getPrimaryLayers({filters:n}),r=[];return a.forEach(function(i){t=i.getSubcontainersByCoordinates(e.localCoords),r=r.concat(t)}),r}},{key:"_defaultTick",value:function(){var e,i,o=1e3,u=0,l=(new Date).getTime();s.ticker.shared.add(function(){k===!0&&(this.trackFPSCB&&(e=(new Date).getTime()),a.render(t),r&&r.render(n),k=!1,this.trackFPSCB&&(i+=Math.round(Math.abs(e-(new Date).getTime())))),this.trackFPSCB&&(u++,l+o<(new Date).getTime()&&(this.trackFPSCB({FPS:u,FPStime:l,renderTime:i,drawCount:a.drawCount}),u=0,i=0,l=(new Date).getTime()))}.bind(this))}},{key:"_addObjectToUIlayer",value:function(e,t,i){switch(e){case m:this.getStaticLayer().addUIObject(t,i);break;case p:this.getMovableLayer().addUIObject(t,i)}}}]),u}();window.flatworld.Flatworld=S}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){function e(e,a){var d=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],c=d.trackFPSCB,s=void 0===c?!1:c,y=d.isHiddenByDefault,p=void 0===y?!0:y,f=d.cache,m=void 0===f?!1:f,l=d.minimapCanvas,u=d.scaleMode,h=void 0===u?t.SCALE_MODES.DEFAULT:u;i.debug("============== Hexagonal Map factory started =============");var w=o.environmentDetection.getPixelRatio(),b="string"==typeof a.map?JSON.parse(a.map):a.map,g="string"==typeof a.type?JSON.parse(a.type):a.type,S="string"==typeof a.game?JSON.parse(a.game):a.game,v=o.resize.getWindowSize(),D={ObjectTerrain:n.objects.ObjectHexaTerrain,ObjectUnit:n.objects.ObjectHexaUnit},x={mapSize:S.mapSize,bounds:{x:0,y:0,width:v.x,height:v.y},rendererOptions:{resolution:w,autoResize:!0,transparent:!0,antialias:!1},subcontainers:{width:500,height:500,maxDetectionOffset:100,isHiddenByDefault:p},trackFPSCB:s,cache:m,defaultScaleMode:h,minimapCanvas:l},O=new r(e,x);return t.SCALE_MODES.DEFAULT=1,b.layers.forEach(function(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e)))throw i.error("Problem in hexaFactory, with layerData:"+JSON.stringify(e)),new Error("Problem in hexaFactory, with layerData:",e);var a,r=O.getRenderer(),o={name:e.name,coord:e.coord,drawOutsideViewport:{x:r.width,y:r.height},selectable:"unitLayer"===e.name};try{a=O.addLayer(o),e.objectGroups.forEach(function(e){var r=e.typeImageData;return r?void e.objects.forEach(function(o){var n,d,c,s;try{if(n=g.objectData[r][o.objType],!n)throw i.error("Bad mapData for type:",r,o.objType,o.name),new Error("Bad mapData for type:",r,o.objType,o.name);c=t.Texture.fromFrame(n.image),d={data:{typeData:n,activeData:o.data},radius:S.hexagonRadius,minimapColor:n.minimapColor,minimapSize:n.minimapSize},s=new D[e.type](c,o.coord,d),a.addChild(s)}catch(y){i.error(y)}}):void i.error("Error with spritesheetType-data")})}catch(n){i.error("Problem:"+JSON.stringify(e.type)+" ---- "+JSON.stringify(n.stack))}}),O.moveMap(b.startPoint),O}var t=window.flatworld_libraries.PIXI,a=window.flatworld,r=a.Flatworld,o=a.utils,i=a.log,n=window.flatworld.extensions.hexagons;window.flatworld.factories.hexaFactory=e}();