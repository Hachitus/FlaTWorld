<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\components\map\extensions\hexagons\utils\hexagonMath.js - FlaTWorld</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="FlaTWorld" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/flatworld.eventListeners.html">flatworld.eventListeners</a></li>
                                <li><a href="../classes/flatworld.extensions.baseEventlisteners.html">flatworld.extensions.baseEventlisteners</a></li>
                                <li><a href="../classes/flatworld.extensions.hexagons.ObjectHexaTerrain.html">flatworld.extensions.hexagons.ObjectHexaTerrain</a></li>
                                <li><a href="../classes/flatworld.extensions.hexagons.ObjectHexaUnit.html">flatworld.extensions.hexagons.ObjectHexaUnit</a></li>
                                <li><a href="../classes/flatworld.extensions.hexagons.selectHexagonObject.html">flatworld.extensions.hexagons.selectHexagonObject</a></li>
                                <li><a href="../classes/flatworld.extensions.hexagons.setupHexagonClick.html">flatworld.extensions.hexagons.setupHexagonClick</a></li>
                                <li><a href="../classes/flatworld.extensions.hexagons.utils.html">flatworld.extensions.hexagons.utils</a></li>
                                <li><a href="../classes/flatworld.extensions.mapDrag.html">flatworld.extensions.mapDrag</a></li>
                                <li><a href="../classes/flatworld.extensions.mapMovement.html">flatworld.extensions.mapMovement</a></li>
                                <li><a href="../classes/flatworld.extensions.mapZoom.html">flatworld.extensions.mapZoom</a></li>
                                <li><a href="../classes/flatworld.Flatworld.html">flatworld.Flatworld</a></li>
                                <li><a href="../classes/flatworld.generalUtils.arrays.html">flatworld.generalUtils.arrays</a></li>
                                <li><a href="../classes/flatworld.generalUtils.environmentDetections.html">flatworld.generalUtils.environmentDetections</a></li>
                                <li><a href="../classes/flatworld.generalUtils.polyfills.html">flatworld.generalUtils.polyfills</a></li>
                                <li><a href="../classes/flatworld.log.html">flatworld.log</a></li>
                                <li><a href="../classes/flatworld.mapApi.html">flatworld.mapApi</a></li>
                                <li><a href="../classes/flatworld.MapDataManipulator.html">flatworld.MapDataManipulator</a></li>
                                <li><a href="../classes/flatworld.mapEvents.html">flatworld.mapEvents</a></li>
                                <li><a href="../classes/flatworld.maplayers.MapLayer.html">flatworld.maplayers.MapLayer</a></li>
                                <li><a href="../classes/flatworld.maplayers.MapLayerParent.html">flatworld.maplayers.MapLayerParent</a></li>
                                <li><a href="../classes/flatworld.maplayers.MapSubcontainer.html">flatworld.maplayers.MapSubcontainer</a></li>
                                <li><a href="../classes/flatworld.mapStates.html">flatworld.mapStates</a></li>
                                <li><a href="../classes/flatworld.ObjectManager.html">flatworld.ObjectManager</a></li>
                                <li><a href="../classes/flatworld.objects.ObjectSprite.html">flatworld.objects.ObjectSprite</a></li>
                                <li><a href="../classes/flatworld.objects.ObjectSpriteTerrain.html">flatworld.objects.ObjectSpriteTerrain</a></li>
                                <li><a href="../classes/flatworld.objects.ObjectSpriteUnit.html">flatworld.objects.ObjectSpriteUnit</a></li>
                                <li><a href="../classes/flatworld.Preload.html">flatworld.Preload</a></li>
                                <li><a href="../classes/flatworld.UI.html">flatworld.UI</a></li>
                                <li><a href="../classes/flatworld.UIs.default.html">flatworld.UIs.default</a></li>
                                <li><a href="../classes/flatworld.utils.dataManipulation.html">flatworld.utils.dataManipulation</a></li>
                                <li><a href="../classes/flatworld.utils.effects.html">flatworld.utils.effects</a></li>
                                <li><a href="../classes/flatworld.utils.environment.html">flatworld.utils.environment</a></li>
                                <li><a href="../classes/flatworld.utils.general.html">flatworld.utils.general</a></li>
                                <li><a href="../classes/flatworld.utils.mouse.html">flatworld.utils.mouse</a></li>
                                <li><a href="../classes/flatworld.utils.Quadtree.html">flatworld.utils.Quadtree</a></li>
                                <li><a href="../classes/flatworld.utils.resize.html">flatworld.utils.resize</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: src\components\map\extensions\hexagons\utils\hexagonMath.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function () {
  &#x27;use strict&#x27;;

  /*---------------------
  ------- IMPORT --------
  ----------------------*/
  var mapLog = window.flatworld.log;

  /*-----------------------
  ---------- API ----------
  -----------------------*/
  window.flatworld.extensions.hexagons.utils.init = init;
  window.flatworld.extensions.hexagons.utils.createHexagonGridCoordinates = createHexagonGridCoordinates;
  window.flatworld.extensions.hexagons.utils.getHexagonPoints = getHexagonPoints;
  window.flatworld.extensions.hexagons.utils.calcShortDiagonal = calcShortDiagonal;
  window.flatworld.extensions.hexagons.utils.calcLongDiagonal = calcLongDiagonal;
  window.flatworld.extensions.hexagons.utils.hexaHitTest = hexaHitTest;
  window.flatworld.extensions.hexagons.utils.getClosestHexagonCenter = getClosestHexagonCenter;


  /*-----------------------
  ------- VARIABLES -------
  -----------------------*/
  var globalRadius, globalStartingPoint, globalOrientation;

  /**
   * Utility module, for making different calculations and tests when hexagon based grid map in use
   *
   * @namespace flatworld.extensions.hexagons
   * @class utils
   */
  /*-----------------------
  --------- PUBLIC --------
  -----------------------*/
  /**
   * Set hexagon radius
   *
   * @static
   * @method setRadius
   * @param {Number} radius    The radius of the hexagon
   */
  function init(radius, startingPoint = { x: 0, y: 0}, { orientation = &quot;horizontal&quot; } = {}) {
    globalRadius = radius;
    globalStartingPoint = startingPoint;
    globalOrientation = orientation;
  }
  /**
   * @method
   * @static
   * @method getHexagonPoints
   * @param {Float} radius      radius of the hexagon
   * @param {object} options    extra options, like generating horizontal hexagon points and
   * how many decimals to round
  */
  function getHexagonPoints({ radius = globalRadius, orientation = &quot;horizontal&quot; } = {}) {
    if (!radius) {
      mapLog.error(&quot;You need to define at least globalRadius for the hexagonMath utils class&quot;);
    }
    const OFFSET = orientation === &quot;horizontal&quot; ? 0.5 : 0;
    const CENTER = {
      x: radius,
      y: radius
    };
    var angle = 2 * Math.PI / 6 * OFFSET;
    var x = CENTER.x * Math.cos(angle);
    var y = CENTER.y * Math.sin(angle);
    var points = [];

    points.push({x, y});

    for (let i = 1; i &lt; 7; i++) {
      angle = 2 * Math.PI / 6 * (i + OFFSET);
      x = CENTER.x * Math.cos(angle);
      y = CENTER.y * Math.sin(angle);

      points.push({x, y});
    }

    return points;
  }
  /**
   * Calculates the hexagons:
   * innerDiameter
   * - Vertical / Flat hexagons height
   * - Horizontal / pointy hexagons width
   *
   * @method calcLongDiagonal
   * @static
   * @param {Object} {}               *OPTIONAL*
   * @param {float} {}.radius         Usually the radius of the hexagon
   * @param {string} {}.type          If you provide something else than radius, where the calculation is based from
   */
  function calcShortDiagonal({ radius = globalRadius, floorNumbers = true } = {}) {
    var answer;

    answer = radius * Math.sqrt(3);
    answer = floorNumbers ? Math.floor(answer) : answer;

    return answer;
  }
  /** Calculates the hexagons:
   * outerDiameter
   * - Vertical / Flat hexagons width
   * - Horizontal / pointy hexagons height
   *
   * @method calcLongDiagonal
   * @static
   * @param {Object} {}                 *OPTIONAL*
   * @param {float} {}.radius           Usually the radius of the hexagon
   * @param {string} {}.type            If you provide something else than radius, where the calculation is based from
   */
  function calcLongDiagonal({ radius = globalRadius, floorNumbers = true } = {}) {
    var answer;

    answer = radius * 2;
    answer = floorNumbers ? Math.floor(answer) : answer;

    return answer;
  }
  /** Calculates the hexagons distance between each other in y-coordinate, when orientation is horizontal
   *
   * @method calcSpecialDistance
   * @static
   * @param {Object} {}                   *OPTIONAL*
   * @param {float} {}.radius             Usually the radius of the hexagon
   */
  function calcSpecialDistance({ radius = globalRadius } = {}) {
    return calcLongDiagonal(radius) - radius / 2;
  }
  /**
   * Test do the given coordinates hit the hexagon, given by the points container / array
   *
   * @static
   * @method hexaHitTest
   * @param  {PIXI.Point[]} points             Array of PIXI.points
   * @param  {Object} hitCoords         The coordinates to test against
   * @param  {Integer} hitCoords.x      X coordinate
   * @param  {Integer} hitCoords.y      Y coordinate
   * @param  {Object} offsetCoords      *OPTIONAL* offsetCoordinates that are added to the hitCoordinates.
   * Separate because these are outside the
   * given array.
   * @param  {Integer} offsetCoords.x   X coordinate
   * @param  {Integer} offsetCoords.y   Y coordinate
   * @return {Boolean}                  Is the coordinate inside the hexagon or not
   */

  function hexaHitTest(points, hitCoords, offsetCoords = {x:0, y:0}) {
    var realPolygonPoints;

    realPolygonPoints = points.map(point =&gt; {
      return {
        x: point.x + offsetCoords.x,
        y: point.y + offsetCoords.y
      };
    });

    return pointInPolygon(hitCoords, realPolygonPoints);
  }
  /**
   * Create Array that holds the coordinates for the size of hexagon grid we want to create.
   *
   * @method createHexagonGridCoordinates
   * @static
   * @param {Object} gridSize
   * @param {Object} gridSize.rows      The count of rows in the hexagon grid
   * @param {Object} gridSize.columns   The count of columns in the hexagon grid
   * @param {Object} {}                 *OPTIONAL* configurations in an object
   * @param {Number} {}.radius          The radius of hexagon. Basically the radius of the outer edges / circle of the hexagon.
   * @param {String} {}.orientation     Is it horizontal or vertical hexagon grid. Default: horizontal
   * @return {[]}                       Array that holds the coordinates for the hexagon grid, like [{x: ?, y: ?}]
   */
  function createHexagonGridCoordinates(gridSize, { radius = globalRadius, orientation = &quot;horizontal&quot; } = {}) {
    const { rows, columns } = gridSize;
    var gridArray = [];
    var shortDistance = calcShortDiagonal(radius);
    var longDistance = calcLongDiagonal(radius) - radius / 2;
    var rowHeight, columnWidth;

    /* We set the distances of hexagons / hexagon rows and columns, depending are we building horizontal or vertical hexagon grid. */
    rowHeight = orientation === &quot;horizontal&quot; ? longDistance : shortDistance;
    columnWidth = orientation === &quot;horizontal&quot; ? shortDistance : longDistance;

    for (let row = 0; rows &gt; row; row++) {
      for (let column = 0; columns &gt; column; column++) {
        /* Se the coordinates for each hexagons upper-left corner on the grid */
        gridArray.push({
          x: Math.round(( column * columnWidth ) +
            ( orientation === &quot;horizontal&quot; &amp;&amp; ( row === 0 || row % 2 === 0 ) ? 0 : -shortDistance / 2) ),
          y: row * rowHeight
        });
      }
    }

    return gridArray;
  }
  /**
   * Calculates the closest hexagon center coordinates, for the given coordinates. So aligning the given coordinates to proper hexagon
   * coordinates
   *
   * @static
   * @method getClosestHexagonCenter
   * @requires setRadius has to be set
   * @param {Object} coordinates              The coordinate where we want to find the closest hexagon center point
   */
  function getClosestHexagonCenter(coordinates) {
    var radius = globalRadius;
    var closestHexagonCenter;

    if (!globalOrientation || !radius || !globalStartingPoint) {
      throw new Error(&quot;getClosestHexagonCenter requirements not filled&quot;);
    }

    if (globalOrientation === &quot;horizontal&quot;) {
      closestHexagonCenter = {
        x: Math.round( coordinates.x -
              ( coordinates.x % calcShortDiagonal(radius) ) +
              calcShortDiagonal(radius) / 2 + globalStartingPoint.x ),
        y: Math.round( coordinates.y -
              ( coordinates.y % calcSpecialDistance(radius) ) +
              calcLongDiagonal(radius) / 2 + globalStartingPoint.y )
      };
    } else {
      closestHexagonCenter = {
        x: Math.floor( coordinates.x - ( coordinates.x % calcSpecialDistance(radius) ) + globalStartingPoint.x ),
        y: Math.floor( coordinates.y - ( coordinates.y % calcShortDiagonal(radius) ) + globalStartingPoint.y )
      };
    }

    return closestHexagonCenter;
  }
  /*-----------------------
  --------- PRIVATE -------
  -----------------------*/
  /**
   * credits to: https://github.com/substack/point-in-polygon
   * Tests whether the given point / coordinate is inside the given points. Assuming the points form a polygon
   *
   * @static
   * @private
   * @method pointInPolygon
   * @param  {Object} point             The coordinates to test against
   * @param  {Integer} hitCoords.x      X coordinate
   * @param  {Integer} hitCoords.y      Y coordinate
   * @param  {Integer[]} vs             The points of the polygon to test [0] === x-point, [1] === y-point
   * @return {Boolean}                  Is the coordinate inside the hexagon or not
   */
  function pointInPolygon(point, vs) {
    var x = point.x;
    var y = point.y;
    var inside = false;
    var xi, xj, yi, yj, intersect;

    for (let i = 0, j = vs.length - 1; i &lt; vs.length; j = i++) {
      xi = vs[i].x;
      yi = vs[i].y;
      xj = vs[j].x;
      yj = vs[j].y;
      intersect = ((yi &gt; y) !== (yj &gt; y)) &amp;&amp;
          (x &lt; (xj - xi) * (y - yi) / (yj - yi) + xi);

      if (intersect) {
        inside = !inside;
      }
    }

    return inside;
  }
})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
